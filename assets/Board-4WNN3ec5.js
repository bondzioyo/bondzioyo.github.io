var Ut=Object.defineProperty;var Gt=(t,e,o)=>e in t?Ut(t,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[e]=o;var P=(t,e,o)=>(Gt(t,typeof e!="symbol"?e+"":e,o),o);import{y as ht,r as ae,z as Ze,h as dt,A as zt,o as $,c as j,a as y,i as ut,j as pt,n as Re,F as ue,b as ye,B as Zt,M as Yt,t as U,f as Xt,x as Jt}from"./index-4ThQSH-4.js";const eo={class:"promotion-dialog",open:""},to=["aria-label","onClick","onTouchstartPassive"],oo=ht({__name:"PromotionDialog",props:{state:{}},emits:["promotionSelected"],setup(t,{emit:e}){const o=t,s=[{name:"Queen",data:"q"},{name:"Knight",data:"n"},{name:"Rook",data:"r"},{name:"Bishop",data:"b"}];function n(i){var a,r;(r=(a=o.state).callback)==null||r.call(a,i.data),e("promotionSelected")}return(i,a)=>($(),j("dialog",eo,[($(),j(ue,null,ye(s,r=>y("button",{key:r.name,type:"button",class:Re([r.name.toLowerCase(),i.state.color]),"aria-label":r.name,onClick:l=>n(r),onTouchstartPassive:l=>n(r)},null,42,to)),64))]))}});/**
 * @license
 * Copyright (c) 2023, Jeff Hlywa (jhlywa@gmail.com)
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 * 1. Redistributions of source code must retain the above copyright notice,
 *    this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 *    this list of conditions and the following disclaimer in the documentation
 *    and/or other materials provided with the distribution.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE
 * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
 * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
 * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
 * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
 * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
 * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
 * POSSIBILITY OF SUCH DAMAGE.
 */const A="w",R="b",M="p",qe="n",ke="b",pe="r",X="q",x="k",xe="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",L=-1,so={NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q"},no=["a8","b8","c8","d8","e8","f8","g8","h8","a7","b7","c7","d7","e7","f7","g7","h7","a6","b6","c6","d6","e6","f6","g6","h6","a5","b5","c5","d5","e5","f5","g5","h5","a4","b4","c4","d4","e4","f4","g4","h4","a3","b3","c3","d3","e3","f3","g3","h3","a2","b2","c2","d2","e2","f2","g2","h2","a1","b1","c1","d1","e1","f1","g1","h1"],v={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64},_={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},Pe={b:[16,32,17,15],w:[-16,-32,-17,-15]},Ye={n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},io=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],ro=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],ao={p:1,n:2,b:4,r:8,q:16,k:32},lo="pnbrqkPNBRQK",Xe=[qe,ke,pe,X],co=7,ho=6,uo=1,po=0,_e={[x]:v.KSIDE_CASTLE,[X]:v.QSIDE_CASTLE},z={w:[{square:_.a1,flag:v.QSIDE_CASTLE},{square:_.h1,flag:v.KSIDE_CASTLE}],b:[{square:_.a8,flag:v.QSIDE_CASTLE},{square:_.h8,flag:v.KSIDE_CASTLE}]},fo={b:uo,w:ho},go=["1-0","0-1","1/2-1/2","*"];function oe(t){return t>>4}function fe(t){return t&15}function ft(t){return"0123456789".indexOf(t)!==-1}function O(t){const e=fe(t),o=oe(t);return"abcdefgh".substring(e,e+1)+"87654321".substring(o,o+1)}function ce(t){return t===A?R:A}function mo(t){const e=t.split(/\s+/);if(e.length!==6)return{ok:!1,error:"Invalid FEN: must contain six space-delimited fields"};const o=parseInt(e[5],10);if(isNaN(o)||o<=0)return{ok:!1,error:"Invalid FEN: move number must be a positive integer"};const s=parseInt(e[4],10);if(isNaN(s)||s<0)return{ok:!1,error:"Invalid FEN: half move counter number must be a non-negative integer"};if(!/^(-|[abcdefgh][36])$/.test(e[3]))return{ok:!1,error:"Invalid FEN: en-passant square is invalid"};if(/[^kKqQ-]/.test(e[2]))return{ok:!1,error:"Invalid FEN: castling availability is invalid"};if(!/^(w|b)$/.test(e[1]))return{ok:!1,error:"Invalid FEN: side-to-move is invalid"};const n=e[0].split("/");if(n.length!==8)return{ok:!1,error:"Invalid FEN: piece data does not contain 8 '/'-delimited rows"};for(let a=0;a<n.length;a++){let r=0,l=!1;for(let c=0;c<n[a].length;c++)if(ft(n[a][c])){if(l)return{ok:!1,error:"Invalid FEN: piece data is invalid (consecutive number)"};r+=parseInt(n[a][c],10),l=!0}else{if(!/^[prnbqkPRNBQK]$/.test(n[a][c]))return{ok:!1,error:"Invalid FEN: piece data is invalid (invalid piece)"};r+=1,l=!1}if(r!==8)return{ok:!1,error:"Invalid FEN: piece data is invalid (too many squares in rank)"}}if(e[3][1]=="3"&&e[1]=="w"||e[3][1]=="6"&&e[1]=="b")return{ok:!1,error:"Invalid FEN: illegal en-passant square"};const i=[{color:"white",regex:/K/g},{color:"black",regex:/k/g}];for(const{color:a,regex:r}of i){if(!r.test(e[0]))return{ok:!1,error:`Invalid FEN: missing ${a} king`};if((e[0].match(r)||[]).length>1)return{ok:!1,error:`Invalid FEN: too many ${a} kings`}}return{ok:!0}}function bo(t,e){const o=t.from,s=t.to,n=t.piece;let i=0,a=0,r=0;for(let l=0,c=e.length;l<c;l++){const f=e[l].from,u=e[l].to,d=e[l].piece;n===d&&o!==f&&s===u&&(i++,oe(o)===oe(f)&&a++,fe(o)===fe(f)&&r++)}return i>0?a>0&&r>0?O(o):r>0?O(o).charAt(1):O(o).charAt(0):""}function Z(t,e,o,s,n,i=void 0,a=v.NORMAL){const r=oe(s);if(n===M&&(r===co||r===po))for(let l=0;l<Xe.length;l++){const c=Xe[l];t.push({color:e,from:o,to:s,piece:n,captured:i,promotion:c,flags:a|v.PROMOTION})}else t.push({color:e,from:o,to:s,piece:n,captured:i,flags:a})}function Je(t){let e=t.charAt(0);return e>="a"&&e<="h"?t.match(/[a-h]\d.*[a-h]\d/)?void 0:M:(e=e.toLowerCase(),e==="o"?x:e)}function Ae(t){return t.replace(/=/,"").replace(/[+#]?[?!]*$/,"")}class vo{constructor(e=xe){P(this,"_board",new Array(128));P(this,"_turn",A);P(this,"_header",{});P(this,"_kings",{w:L,b:L});P(this,"_epSquare",-1);P(this,"_halfMoves",0);P(this,"_moveNumber",0);P(this,"_history",[]);P(this,"_comments",{});P(this,"_castling",{w:0,b:0});this.load(e)}clear(e=!1){this._board=new Array(128),this._kings={w:L,b:L},this._turn=A,this._castling={w:0,b:0},this._epSquare=L,this._halfMoves=0,this._moveNumber=1,this._history=[],this._comments={},this._header=e?this._header:{},this._updateSetup(this.fen())}removeHeader(e){e in this._header&&delete this._header[e]}load(e,o=!1){let s=e.split(/\s+/);if(s.length>=2&&s.length<6){const l=["-","-","0","1"];e=s.concat(l.slice(-(6-s.length))).join(" ")}s=e.split(/\s+/);const{ok:n,error:i}=mo(e);if(!n)throw new Error(i);const a=s[0];let r=0;this.clear(o);for(let l=0;l<a.length;l++){const c=a.charAt(l);if(c==="/")r+=8;else if(ft(c))r+=parseInt(c,10);else{const f=c<"a"?A:R;this.put({type:c.toLowerCase(),color:f},O(r)),r++}}this._turn=s[1],s[2].indexOf("K")>-1&&(this._castling.w|=v.KSIDE_CASTLE),s[2].indexOf("Q")>-1&&(this._castling.w|=v.QSIDE_CASTLE),s[2].indexOf("k")>-1&&(this._castling.b|=v.KSIDE_CASTLE),s[2].indexOf("q")>-1&&(this._castling.b|=v.QSIDE_CASTLE),this._epSquare=s[3]==="-"?L:_[s[3]],this._halfMoves=parseInt(s[4],10),this._moveNumber=parseInt(s[5],10),this._updateSetup(this.fen())}fen(){var i,a;let e=0,o="";for(let r=_.a8;r<=_.h1;r++){if(this._board[r]){e>0&&(o+=e,e=0);const{color:l,type:c}=this._board[r];o+=l===A?c.toUpperCase():c.toLowerCase()}else e++;r+1&136&&(e>0&&(o+=e),r!==_.h1&&(o+="/"),e=0,r+=8)}let s="";this._castling[A]&v.KSIDE_CASTLE&&(s+="K"),this._castling[A]&v.QSIDE_CASTLE&&(s+="Q"),this._castling[R]&v.KSIDE_CASTLE&&(s+="k"),this._castling[R]&v.QSIDE_CASTLE&&(s+="q"),s=s||"-";let n="-";if(this._epSquare!==L){const r=this._epSquare+(this._turn===A?16:-16),l=[r+1,r-1];for(const c of l){if(c&136)continue;const f=this._turn;if(((i=this._board[c])==null?void 0:i.color)===f&&((a=this._board[c])==null?void 0:a.type)===M){this._makeMove({color:f,from:c,to:this._epSquare,piece:M,captured:M,flags:v.EP_CAPTURE});const u=!this._isKingAttacked(f);if(this._undoMove(),u){n=O(this._epSquare);break}}}}return[o,this._turn,s,n,this._halfMoves,this._moveNumber].join(" ")}_updateSetup(e){this._history.length>0||(e!==xe?(this._header.SetUp="1",this._header.FEN=e):(delete this._header.SetUp,delete this._header.FEN))}reset(){this.load(xe)}get(e){return this._board[_[e]]||!1}put({type:e,color:o},s){if(lo.indexOf(e.toLowerCase())===-1||!(s in _))return!1;const n=_[s];return e==x&&!(this._kings[o]==L||this._kings[o]==n)?!1:(this._board[n]={type:e,color:o},e===x&&(this._kings[o]=n),this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),!0)}remove(e){const o=this.get(e);return delete this._board[_[e]],o&&o.type===x&&(this._kings[o.color]=L),this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),o}_updateCastlingRights(){var s,n,i,a,r,l,c,f,u,d,m,h;const e=((s=this._board[_.e1])==null?void 0:s.type)===x&&((n=this._board[_.e1])==null?void 0:n.color)===A,o=((i=this._board[_.e8])==null?void 0:i.type)===x&&((a=this._board[_.e8])==null?void 0:a.color)===R;(!e||((r=this._board[_.a1])==null?void 0:r.type)!==pe||((l=this._board[_.a1])==null?void 0:l.color)!==A)&&(this._castling.w&=~v.QSIDE_CASTLE),(!e||((c=this._board[_.h1])==null?void 0:c.type)!==pe||((f=this._board[_.h1])==null?void 0:f.color)!==A)&&(this._castling.w&=~v.KSIDE_CASTLE),(!o||((u=this._board[_.a8])==null?void 0:u.type)!==pe||((d=this._board[_.a8])==null?void 0:d.color)!==R)&&(this._castling.b&=~v.QSIDE_CASTLE),(!o||((m=this._board[_.h8])==null?void 0:m.type)!==pe||((h=this._board[_.h8])==null?void 0:h.color)!==R)&&(this._castling.b&=~v.KSIDE_CASTLE)}_updateEnPassantSquare(){var i,a;if(this._epSquare===L)return;const e=this._epSquare+(this._turn===A?-16:16),o=this._epSquare+(this._turn===A?16:-16),s=[o+1,o-1];if(this._board[e]!==null||this._board[this._epSquare]!==null||((i=this._board[o])==null?void 0:i.color)!==ce(this._turn)||((a=this._board[o])==null?void 0:a.type)!==M){this._epSquare=L;return}const n=r=>{var l,c;return!(r&136)&&((l=this._board[r])==null?void 0:l.color)===this._turn&&((c=this._board[r])==null?void 0:c.type)===M};s.some(n)||(this._epSquare=L)}_attacked(e,o){for(let s=_.a8;s<=_.h1;s++){if(s&136){s+=7;continue}if(this._board[s]===void 0||this._board[s].color!==e)continue;const n=this._board[s],i=s-o;if(i===0)continue;const a=i+119;if(io[a]&ao[n.type]){if(n.type===M){if(i>0){if(n.color===A)return!0}else if(n.color===R)return!0;continue}if(n.type==="n"||n.type==="k")return!0;const r=ro[a];let l=s+r,c=!1;for(;l!==o;){if(this._board[l]!=null){c=!0;break}l+=r}if(!c)return!0}}return!1}_isKingAttacked(e){const o=this._kings[e];return o===-1?!1:this._attacked(ce(e),o)}isAttacked(e,o){return this._attacked(o,_[e])}isCheck(){return this._isKingAttacked(this._turn)}inCheck(){return this.isCheck()}isCheckmate(){return this.isCheck()&&this._moves().length===0}isStalemate(){return!this.isCheck()&&this._moves().length===0}isInsufficientMaterial(){const e={b:0,n:0,r:0,q:0,k:0,p:0},o=[];let s=0,n=0;for(let i=_.a8;i<=_.h1;i++){if(n=(n+1)%2,i&136){i+=7;continue}const a=this._board[i];a&&(e[a.type]=a.type in e?e[a.type]+1:1,a.type===ke&&o.push(n),s++)}if(s===2||s===3&&(e[ke]===1||e[qe]===1))return!0;if(s===e[ke]+2){let i=0;const a=o.length;for(let r=0;r<a;r++)i+=o[r];if(i===0||i===a)return!0}return!1}isThreefoldRepetition(){const e=[],o={};let s=!1;for(;;){const n=this._undoMove();if(!n)break;e.push(n)}for(;;){const n=this.fen().split(" ").slice(0,4).join(" ");o[n]=n in o?o[n]+1:1,o[n]>=3&&(s=!0);const i=e.pop();if(i)this._makeMove(i);else break}return s}isDraw(){return this._halfMoves>=100||this.isStalemate()||this.isInsufficientMaterial()||this.isThreefoldRepetition()}isGameOver(){return this.isCheckmate()||this.isStalemate()||this.isDraw()}moves({verbose:e=!1,square:o=void 0,piece:s=void 0}={}){const n=this._moves({square:o,piece:s});return e?n.map(i=>this._makePretty(i)):n.map(i=>this._moveToSan(i,n))}_moves({legal:e=!0,piece:o=void 0,square:s=void 0}={}){var m;const n=s?s.toLowerCase():void 0,i=o==null?void 0:o.toLowerCase(),a=[],r=this._turn,l=ce(r);let c=_.a8,f=_.h1,u=!1;if(n)if(n in _)c=f=_[n],u=!0;else return[];for(let h=c;h<=f;h++){if(h&136){h+=7;continue}if(!this._board[h]||this._board[h].color===l)continue;const{type:p}=this._board[h];let g;if(p===M){if(i&&i!==p)continue;g=h+Pe[r][0],this._board[g]||(Z(a,r,h,g,M),g=h+Pe[r][1],fo[r]===oe(h)&&!this._board[g]&&Z(a,r,h,g,M,void 0,v.BIG_PAWN));for(let w=2;w<4;w++)g=h+Pe[r][w],!(g&136)&&(((m=this._board[g])==null?void 0:m.color)===l?Z(a,r,h,g,M,this._board[g].type,v.CAPTURE):g===this._epSquare&&Z(a,r,h,g,M,M,v.EP_CAPTURE))}else{if(i&&i!==p)continue;for(let w=0,b=Ye[p].length;w<b;w++){const S=Ye[p][w];for(g=h;g+=S,!(g&136);){if(!this._board[g])Z(a,r,h,g,p);else{if(this._board[g].color===r)break;Z(a,r,h,g,p,this._board[g].type,v.CAPTURE);break}if(p===qe||p===x)break}}}}if((i===void 0||i===x)&&(!u||f===this._kings[r])){if(this._castling[r]&v.KSIDE_CASTLE){const h=this._kings[r],p=h+2;!this._board[h+1]&&!this._board[p]&&!this._attacked(l,this._kings[r])&&!this._attacked(l,h+1)&&!this._attacked(l,p)&&Z(a,r,this._kings[r],p,x,void 0,v.KSIDE_CASTLE)}if(this._castling[r]&v.QSIDE_CASTLE){const h=this._kings[r],p=h-2;!this._board[h-1]&&!this._board[h-2]&&!this._board[h-3]&&!this._attacked(l,this._kings[r])&&!this._attacked(l,h-1)&&!this._attacked(l,p)&&Z(a,r,this._kings[r],p,x,void 0,v.QSIDE_CASTLE)}}if(!e||this._kings[r]===-1)return a;const d=[];for(let h=0,p=a.length;h<p;h++)this._makeMove(a[h]),this._isKingAttacked(r)||d.push(a[h]),this._undoMove();return d}move(e,{strict:o=!1}={}){let s=null;if(typeof e=="string")s=this._moveFromSan(e,o);else if(typeof e=="object"){const i=this._moves();for(let a=0,r=i.length;a<r;a++)if(e.from===O(i[a].from)&&e.to===O(i[a].to)&&(!("promotion"in i[a])||e.promotion===i[a].promotion)){s=i[a];break}}if(!s)throw typeof e=="string"?new Error(`Invalid move: ${e}`):new Error(`Invalid move: ${JSON.stringify(e)}`);const n=this._makePretty(s);return this._makeMove(s),n}_push(e){this._history.push({move:e,kings:{b:this._kings.b,w:this._kings.w},turn:this._turn,castling:{b:this._castling.b,w:this._castling.w},epSquare:this._epSquare,halfMoves:this._halfMoves,moveNumber:this._moveNumber})}_makeMove(e){const o=this._turn,s=ce(o);if(this._push(e),this._board[e.to]=this._board[e.from],delete this._board[e.from],e.flags&v.EP_CAPTURE&&(this._turn===R?delete this._board[e.to-16]:delete this._board[e.to+16]),e.promotion&&(this._board[e.to]={type:e.promotion,color:o}),this._board[e.to].type===x){if(this._kings[o]=e.to,e.flags&v.KSIDE_CASTLE){const n=e.to-1,i=e.to+1;this._board[n]=this._board[i],delete this._board[i]}else if(e.flags&v.QSIDE_CASTLE){const n=e.to+1,i=e.to-2;this._board[n]=this._board[i],delete this._board[i]}this._castling[o]=0}if(this._castling[o]){for(let n=0,i=z[o].length;n<i;n++)if(e.from===z[o][n].square&&this._castling[o]&z[o][n].flag){this._castling[o]^=z[o][n].flag;break}}if(this._castling[s]){for(let n=0,i=z[s].length;n<i;n++)if(e.to===z[s][n].square&&this._castling[s]&z[s][n].flag){this._castling[s]^=z[s][n].flag;break}}e.flags&v.BIG_PAWN?o===R?this._epSquare=e.to-16:this._epSquare=e.to+16:this._epSquare=L,e.piece===M?this._halfMoves=0:e.flags&(v.CAPTURE|v.EP_CAPTURE)?this._halfMoves=0:this._halfMoves++,o===R&&this._moveNumber++,this._turn=s}undo(){const e=this._undoMove();return e?this._makePretty(e):null}_undoMove(){const e=this._history.pop();if(e===void 0)return null;const o=e.move;this._kings=e.kings,this._turn=e.turn,this._castling=e.castling,this._epSquare=e.epSquare,this._halfMoves=e.halfMoves,this._moveNumber=e.moveNumber;const s=this._turn,n=ce(s);if(this._board[o.from]=this._board[o.to],this._board[o.from].type=o.piece,delete this._board[o.to],o.captured)if(o.flags&v.EP_CAPTURE){let i;s===R?i=o.to-16:i=o.to+16,this._board[i]={type:M,color:n}}else this._board[o.to]={type:o.captured,color:n};if(o.flags&(v.KSIDE_CASTLE|v.QSIDE_CASTLE)){let i,a;o.flags&v.KSIDE_CASTLE?(i=o.to+1,a=o.to-1):(i=o.to-2,a=o.to+1),this._board[i]=this._board[a],delete this._board[a]}return o}pgn({newline:e=`
`,maxWidth:o=0}={}){const s=[];let n=!1;for(const d in this._header)s.push("["+d+' "'+this._header[d]+'"]'+e),n=!0;n&&this._history.length&&s.push(e);const i=d=>{const m=this._comments[this.fen()];if(typeof m<"u"){const h=d.length>0?" ":"";d=`${d}${h}{${m}}`}return d},a=[];for(;this._history.length>0;)a.push(this._undoMove());const r=[];let l="";for(a.length===0&&r.push(i(""));a.length>0;){l=i(l);const d=a.pop();if(!d)break;if(!this._history.length&&d.color==="b"){const m=`${this._moveNumber}. ...`;l=l?`${l} ${m}`:m}else d.color==="w"&&(l.length&&r.push(l),l=this._moveNumber+".");l=l+" "+this._moveToSan(d,this._moves({legal:!0})),this._makeMove(d)}if(l.length&&r.push(i(l)),typeof this._header.Result<"u"&&r.push(this._header.Result),o===0)return s.join("")+r.join(" ");const c=function(){return s.length>0&&s[s.length-1]===" "?(s.pop(),!0):!1},f=function(d,m){for(const h of m.split(" "))if(h){if(d+h.length>o){for(;c();)d--;s.push(e),d=0}s.push(h),d+=h.length,s.push(" "),d++}return c()&&d--,d};let u=0;for(let d=0;d<r.length;d++){if(u+r[d].length>o&&r[d].includes("{")){u=f(u,r[d]);continue}u+r[d].length>o&&d!==0?(s[s.length-1]===" "&&s.pop(),s.push(e),u=0):d!==0&&(s.push(" "),u++),s.push(r[d]),u+=r[d].length}return s.join("")}header(...e){for(let o=0;o<e.length;o+=2)typeof e[o]=="string"&&typeof e[o+1]=="string"&&(this._header[e[o]]=e[o+1]);return this._header}loadPgn(e,{strict:o=!1,newlineChar:s=`\r?
`}={}){function n(b){return b.replace(/\\/g,"\\")}function i(b){const S={},D=b.split(new RegExp(n(s)));let I="",re="";for(let H=0;H<D.length;H++){const k=/^\s*\[\s*([A-Za-z]+)\s*"(.*)"\s*\]\s*$/;I=D[H].replace(k,"$1"),re=D[H].replace(k,"$2"),I.trim().length>0&&(S[I]=re)}return S}e=e.trim();const a=new RegExp("^(\\[((?:"+n(s)+")|.)*\\])((?:\\s*"+n(s)+"){2}|(?:\\s*"+n(s)+")*$)").exec(e),r=a&&a.length>=2?a[1]:"";this.reset();const l=i(r);let c="";for(const b in l)b.toLowerCase()==="fen"&&(c=l[b]),this.header(b,l[b]);if(!o)c&&this.load(c,!0);else if(l.SetUp==="1"){if(!("FEN"in l))throw new Error("Invalid PGN: FEN tag must be supplied with SetUp tag");this.load(l.FEN,!0)}function f(b){return Array.from(b).map(function(S){return S.charCodeAt(0)<128?S.charCodeAt(0).toString(16):encodeURIComponent(S).replace(/%/g,"").toLowerCase()}).join("")}function u(b){return b.length==0?"":decodeURIComponent("%"+(b.match(/.{1,2}/g)||[]).join("%"))}const d=function(b){return b=b.replace(new RegExp(n(s),"g")," "),`{${f(b.slice(1,b.length-1))}}`},m=function(b){if(b.startsWith("{")&&b.endsWith("}"))return u(b.slice(1,b.length-1))};let h=e.replace(r,"").replace(new RegExp(`({[^}]*})+?|;([^${n(s)}]*)`,"g"),function(b,S,D){return S!==void 0?d(S):" "+d(`{${D.slice(1)}}`)}).replace(new RegExp(n(s),"g")," ");const p=/(\([^()]+\))+?/g;for(;p.test(h);)h=h.replace(p,"");h=h.replace(/\d+\.(\.\.)?/g,""),h=h.replace(/\.\.\./g,""),h=h.replace(/\$\d+/g,"");let g=h.trim().split(new RegExp(/\s+/));g=g.filter(b=>b!=="");let w="";for(let b=0;b<g.length;b++){const S=m(g[b]);if(S!==void 0){this._comments[this.fen()]=S;continue}const D=this._moveFromSan(g[b],o);if(D==null)if(go.indexOf(g[b])>-1)w=g[b];else throw new Error(`Invalid move in PGN: ${g[b]}`);else w="",this._makeMove(D)}w&&Object.keys(this._header).length&&!this._header.Result&&this.header("Result",w)}_moveToSan(e,o){let s="";if(e.flags&v.KSIDE_CASTLE)s="O-O";else if(e.flags&v.QSIDE_CASTLE)s="O-O-O";else{if(e.piece!==M){const n=bo(e,o);s+=e.piece.toUpperCase()+n}e.flags&(v.CAPTURE|v.EP_CAPTURE)&&(e.piece===M&&(s+=O(e.from)[0]),s+="x"),s+=O(e.to),e.promotion&&(s+="="+e.promotion.toUpperCase())}return this._makeMove(e),this.isCheck()&&(this.isCheckmate()?s+="#":s+="+"),this._undoMove(),s}_moveFromSan(e,o=!1){const s=Ae(e);let n=Je(s),i=this._moves({legal:!0,piece:n});for(let d=0,m=i.length;d<m;d++)if(s===Ae(this._moveToSan(i[d],i)))return i[d];if(o)return null;let a,r,l,c,f,u=!1;if(r=s.match(/([pnbrqkPNBRQK])?([a-h][1-8])x?-?([a-h][1-8])([qrbnQRBN])?/),r?(a=r[1],l=r[2],c=r[3],f=r[4],l.length==1&&(u=!0)):(r=s.match(/([pnbrqkPNBRQK])?([a-h]?[1-8]?)x?-?([a-h][1-8])([qrbnQRBN])?/),r&&(a=r[1],l=r[2],c=r[3],f=r[4],l.length==1&&(u=!0))),n=Je(s),i=this._moves({legal:!0,piece:a||n}),!c)return null;for(let d=0,m=i.length;d<m;d++)if(l){if((!a||a.toLowerCase()==i[d].piece)&&_[l]==i[d].from&&_[c]==i[d].to&&(!f||f.toLowerCase()==i[d].promotion))return i[d];if(u){const h=O(i[d].from);if((!a||a.toLowerCase()==i[d].piece)&&_[c]==i[d].to&&(l==h[0]||l==h[1])&&(!f||f.toLowerCase()==i[d].promotion))return i[d]}}else if(s===Ae(this._moveToSan(i[d],i)).replace("x",""))return i[d];return null}ascii(){let e=`   +------------------------+
`;for(let o=_.a8;o<=_.h1;o++){if(fe(o)===0&&(e+=" "+"87654321"[oe(o)]+" |"),this._board[o]){const s=this._board[o].type,n=this._board[o].color===A?s.toUpperCase():s.toLowerCase();e+=" "+n+" "}else e+=" . ";o+1&136&&(e+=`|
`,o+=8)}return e+=`   +------------------------+
`,e+="     a  b  c  d  e  f  g  h",e}perft(e){const o=this._moves({legal:!1});let s=0;const n=this._turn;for(let i=0,a=o.length;i<a;i++)this._makeMove(o[i]),this._isKingAttacked(n)||(e-1>0?s+=this.perft(e-1):s++),this._undoMove();return s}_makePretty(e){const{color:o,piece:s,from:n,to:i,flags:a,captured:r,promotion:l}=e;let c="";for(const m in v)v[m]&a&&(c+=so[m]);const f=O(n),u=O(i),d={color:o,piece:s,from:f,to:u,san:this._moveToSan(e,this._moves({legal:!0})),flags:c,lan:f+u,before:this.fen(),after:""};return this._makeMove(e),d.after=this.fen(),this._undoMove(),r&&(d.captured=r),l&&(d.promotion=l,d.lan+=l),d}turn(){return this._turn}board(){const e=[];let o=[];for(let s=_.a8;s<=_.h1;s++)this._board[s]==null?o.push(null):o.push({square:O(s),type:this._board[s].type,color:this._board[s].color}),s+1&136&&(e.push(o),o=[],s+=8);return e}squareColor(e){if(e in _){const o=_[e];return(oe(o)+fe(o))%2===0?"light":"dark"}return null}history({verbose:e=!1}={}){const o=[],s=[];for(;this._history.length>0;)o.push(this._undoMove());for(;;){const n=o.pop();if(!n)break;e?s.push(this._makePretty(n)):s.push(this._moveToSan(n,this._moves())),this._makeMove(n)}return s}_pruneComments(){const e=[],o={},s=n=>{n in this._comments&&(o[n]=this._comments[n])};for(;this._history.length>0;)e.push(this._undoMove());for(s(this.fen());;){const n=e.pop();if(!n)break;this._makeMove(n),s(this.fen())}this._comments=o}getComment(){return this._comments[this.fen()]}setComment(e){this._comments[this.fen()]=e.replace("{","[").replace("}","]")}deleteComment(){const e=this._comments[this.fen()];return delete this._comments[this.fen()],e}getComments(){return this._pruneComments(),Object.keys(this._comments).map(e=>({fen:e,comment:this._comments[e]}))}deleteComments(){return this._pruneComments(),Object.keys(this._comments).map(e=>{const o=this._comments[e];return delete this._comments[e],{fen:e,comment:o}})}setCastlingRights(e,o){for(const n of[x,X])o[n]!==void 0&&(o[n]?this._castling[e]|=_e[n]:this._castling[e]&=~_e[n]);this._updateCastlingRights();const s=this.getCastlingRights(e);return(o[x]===void 0||o[x]===s[x])&&(o[X]===void 0||o[X]===s[X])}getCastlingRights(e){return{[x]:(this._castling[e]&_e[x])!==0,[X]:(this._castling[e]&_e[X])!==0}}moveNumber(){return this._moveNumber}}function _o(t){const e=[];for(const o of t)e.push({orig:o.to,brush:"yellow"}),o.captured&&e.push({orig:o.from,dest:o.to,brush:"red"}),o.san.includes("+")&&e.push({orig:o.from,dest:o.to,brush:"blue"});return e}function we(t){return t==="w"?"white":"black"}function et(t){const e=new Map;for(const o of no){const s=t.moves({square:o,verbose:!0});s.length&&e.set(s[0].from,s.map(n=>n.to))}return e}function wo(t,e){if((e==null?void 0:e.type)!=="p")return!1;const o=(e==null?void 0:e.color)==="w"?"8":"1";return t[1]===o}function ge(t){return!!t&&t instanceof Object&&!(t instanceof Array)&&!(t instanceof Function)}function Ce(t){return ge(t)?Object.fromEntries(Object.entries(t).map(([e,o])=>[e,Ce(o)])):t}function gt(t,e){const o={...t,...e};for(const s in o)o[s]=ge(t==null?void 0:t[s])&&ge(e==null?void 0:e[s])?gt(t[s],e[s]):Ce(o[s]);return o}function mt(t,e){const o={};for(const s in e)if(ge(t==null?void 0:t[s])&&ge(e==null?void 0:e[s])){const n=mt(t[s],e[s]);Object.keys(n).length>0&&(o[s]=n)}else(t==null?void 0:t[s])!==e[s]&&(o[s]=e[s]);return o}const yo={p:"pawn",n:"knight",b:"bishop",r:"rook",q:"queen",k:"king"},ko=new Map([["b1",["a3","c3"]],["g1",["f3","h3"]],["a2",["a3","a4"]],["b2",["b3","b4"]],["c2",["c3","c4"]],["d2",["d3","d4"]],["e2",["e3","e4"]],["f2",["f3","f4"]],["g2",["g3","g4"]],["h2",["h3","h4"]]]),Co="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",So={fen:Co,orientation:"white",turnColor:"white",coordinates:!1,autoCastle:!0,viewOnly:!1,disableContextMenu:!1,addPieceZIndex:!1,blockTouchScroll:!1,highlight:{lastMove:!0,check:!0},animation:{enabled:!0,duration:300},lastMove:void 0,movable:{free:!1,color:"white",showDests:!0,dests:ko,events:{after:()=>{},afterNewPiece:void 0},rookCastle:!0},premovable:{enabled:!0,showDests:!0,castle:!0,events:{set:void 0,unset:void 0}},predroppable:{enabled:!1,events:{set:void 0,unset:void 0}},draggable:{enabled:!0,distance:3,autoDistance:!0,showGhost:!0,deleteOnDropOff:!1},selectable:{enabled:!0},events:{change:void 0,move:void 0,dropNewPiece:void 0,select:void 0,insert:void 0},drawable:{enabled:!0,visible:!0,defaultSnapToValidMove:!0,eraseOnClick:!0,shapes:[],autoShapes:[],brushes:{green:{key:"g",color:"#15781B",opacity:1,lineWidth:10},red:{key:"r",color:"#882020",opacity:1,lineWidth:10},blue:{key:"b",color:"#003088",opacity:1,lineWidth:10},yellow:{key:"y",color:"#e68f00",opacity:1,lineWidth:10},paleBlue:{key:"pb",color:"#003088",opacity:.4,lineWidth:15},paleGreen:{key:"pg",color:"#15781B",opacity:.4,lineWidth:15},paleRed:{key:"pr",color:"#882020",opacity:.4,lineWidth:15},paleGrey:{key:"pgr",color:"#4a4a4a",opacity:.35,lineWidth:15}}}},Eo=["white","black"],Ke=["a","b","c","d","e","f","g","h"],Be=["1","2","3","4","5","6","7","8"],Mo=[...Be].reverse(),je=Array.prototype.concat(...Ke.map(t=>Be.map(e=>t+e))),K=t=>je[8*t[0]+t[1]],C=t=>[t.charCodeAt(0)-97,t.charCodeAt(1)-49],bt=je.map(C);function xo(t){let e;const o=()=>(e===void 0&&(e=t()),e);return o.clear=()=>{e=void 0},o}const Po=()=>{let t;return{start(){t=performance.now()},cancel(){t=void 0},stop(){if(!t)return 0;const e=performance.now()-t;return t=void 0,e}}},Ve=t=>t==="white"?"black":"white",me=(t,e)=>{const o=t[0]-e[0],s=t[1]-e[1];return o*o+s*s},Le=(t,e)=>t.role===e.role&&t.color===e.color,be=t=>(e,o)=>[(o?e[0]:7-e[0])*t.width/8,(o?7-e[1]:e[1])*t.height/8],W=(t,e)=>{t.style.transform=`translate(${e[0]}px,${e[1]}px)`},vt=(t,e,o=1)=>{t.style.transform=`translate(${e[0]}px,${e[1]}px) scale(${o})`},Fe=(t,e)=>{t.style.visibility=e?"visible":"hidden"},ne=t=>{var e;if(t.clientX||t.clientX===0)return[t.clientX,t.clientY];if(!((e=t.targetTouches)===null||e===void 0)&&e[0])return[t.targetTouches[0].clientX,t.targetTouches[0].clientY]},_t=t=>t.buttons===2||t.button===2,G=(t,e)=>{const o=document.createElement(t);return e&&(o.className=e),o};function wt(t,e,o){const s=C(t);return e||(s[0]=7-s[0],s[1]=7-s[1]),[o.left+o.width*s[0]/8+o.width/16,o.top+o.height*(7-s[1])/8+o.height/16]}const se=(t,e)=>Math.abs(t-e),Ao=t=>(e,o,s,n)=>se(e,s)<2&&(t==="white"?n===o+1||o<=1&&n===o+2&&e===s:n===o-1||o>=6&&n===o-2&&e===s),yt=(t,e,o,s)=>{const n=se(t,o),i=se(e,s);return n===1&&i===2||n===2&&i===1},kt=(t,e,o,s)=>se(t,o)===se(e,s),Ct=(t,e,o,s)=>t===o||e===s,St=(t,e,o,s)=>kt(t,e,o,s)||Ct(t,e,o,s),To=(t,e,o)=>(s,n,i,a)=>se(s,i)<2&&se(n,a)<2||o&&n===a&&n===(t==="white"?0:7)&&(s===4&&(i===2&&e.includes(0)||i===6&&e.includes(7))||e.includes(i));function Io(t,e){const o=e==="white"?"1":"8",s=[];for(const[n,i]of t)n[1]===o&&i.color===e&&i.role==="rook"&&s.push(C(n)[0]);return s}function Et(t,e,o){const s=t.get(e);if(!s)return[];const n=C(e),i=s.role,a=i==="pawn"?Ao(s.color):i==="knight"?yt:i==="bishop"?kt:i==="rook"?Ct:i==="queen"?St:To(s.color,Io(t,s.color),o);return bt.filter(r=>(n[0]!==r[0]||n[1]!==r[1])&&a(n[0],n[1],r[0],r[1])).map(K)}function N(t,...e){t&&setTimeout(()=>t(...e),1)}function No(t){t.orientation=Ve(t.orientation),t.animation.current=t.draggable.current=t.selected=void 0}function qo(t,e){for(const[o,s]of e)s?t.pieces.set(o,s):t.pieces.delete(o)}function Lo(t,e){if(t.check=void 0,e===!0&&(e=t.turnColor),e)for(const[o,s]of t.pieces)s.role==="king"&&s.color===e&&(t.check=o)}function Oo(t,e,o,s){ee(t),t.premovable.current=[e,o],N(t.premovable.events.set,e,o,s)}function J(t){t.premovable.current&&(t.premovable.current=void 0,N(t.premovable.events.unset))}function $o(t,e,o){J(t),t.predroppable.current={role:e,key:o},N(t.predroppable.events.set,e,o)}function ee(t){const e=t.predroppable;e.current&&(e.current=void 0,N(e.events.unset))}function Do(t,e,o){if(!t.autoCastle)return!1;const s=t.pieces.get(e);if(!s||s.role!=="king")return!1;const n=C(e),i=C(o);if(n[1]!==0&&n[1]!==7||n[1]!==i[1])return!1;n[0]===4&&!t.pieces.has(o)&&(i[0]===6?o=K([7,i[1]]):i[0]===2&&(o=K([0,i[1]])));const a=t.pieces.get(o);return!a||a.color!==s.color||a.role!=="rook"?!1:(t.pieces.delete(e),t.pieces.delete(o),n[0]<i[0]?(t.pieces.set(K([6,i[1]]),s),t.pieces.set(K([5,i[1]]),a)):(t.pieces.set(K([2,i[1]]),s),t.pieces.set(K([3,i[1]]),a)),!0)}function Mt(t,e,o){const s=t.pieces.get(e),n=t.pieces.get(o);if(e===o||!s)return!1;const i=n&&n.color!==s.color?n:void 0;return o===t.selected&&B(t),N(t.events.move,e,o,i),Do(t,e,o)||(t.pieces.set(o,s),t.pieces.delete(e)),t.lastMove=[e,o],t.check=void 0,N(t.events.change),i||!0}function We(t,e,o,s){if(t.pieces.has(o))if(s)t.pieces.delete(o);else return!1;return N(t.events.dropNewPiece,e,o),t.pieces.set(o,e),t.lastMove=[o],t.check=void 0,N(t.events.change),t.movable.dests=void 0,t.turnColor=Ve(t.turnColor),!0}function xt(t,e,o){const s=Mt(t,e,o);return s&&(t.movable.dests=void 0,t.turnColor=Ve(t.turnColor),t.animation.current=void 0),s}function Pt(t,e,o){if(He(t,e,o)){const s=xt(t,e,o);if(s){const n=t.hold.stop();B(t);const i={premove:!1,ctrlKey:t.stats.ctrlKey,holdTime:n};return s!==!0&&(i.captured=s),N(t.movable.events.after,e,o,i),!0}}else if(Ko(t,e,o))return Oo(t,e,o,{ctrlKey:t.stats.ctrlKey}),B(t),!0;return B(t),!1}function At(t,e,o,s){const n=t.pieces.get(e);n&&(Ro(t,e,o)||s)?(t.pieces.delete(e),We(t,n,o,s),N(t.movable.events.afterNewPiece,n.role,o,{premove:!1,predrop:!1})):n&&Bo(t,e,o)?$o(t,n.role,o):(J(t),ee(t)),t.pieces.delete(e),B(t)}function Oe(t,e,o){if(N(t.events.select,e),t.selected){if(t.selected===e&&!t.draggable.enabled){B(t),t.hold.cancel();return}else if((t.selectable.enabled||o)&&t.selected!==e&&Pt(t,t.selected,e)){t.stats.dragged=!1;return}}(t.selectable.enabled||t.draggable.enabled)&&(It(t,e)||Qe(t,e))&&(Tt(t,e),t.hold.start())}function Tt(t,e){t.selected=e,Qe(t,e)?t.premovable.customDests||(t.premovable.dests=Et(t.pieces,e,t.premovable.castle)):t.premovable.dests=void 0}function B(t){t.selected=void 0,t.premovable.dests=void 0,t.hold.cancel()}function It(t,e){const o=t.pieces.get(e);return!!o&&(t.movable.color==="both"||t.movable.color===o.color&&t.turnColor===o.color)}const He=(t,e,o)=>{var s,n;return e!==o&&It(t,e)&&(t.movable.free||!!(!((n=(s=t.movable.dests)===null||s===void 0?void 0:s.get(e))===null||n===void 0)&&n.includes(o)))};function Ro(t,e,o){const s=t.pieces.get(e);return!!s&&(e===o||!t.pieces.has(o))&&(t.movable.color==="both"||t.movable.color===s.color&&t.turnColor===s.color)}function Qe(t,e){const o=t.pieces.get(e);return!!o&&t.premovable.enabled&&t.movable.color===o.color&&t.turnColor!==o.color}function Ko(t,e,o){var s,n;const i=(n=(s=t.premovable.customDests)===null||s===void 0?void 0:s.get(e))!==null&&n!==void 0?n:Et(t.pieces,e,t.premovable.castle);return e!==o&&Qe(t,e)&&i.includes(o)}function Bo(t,e,o){const s=t.pieces.get(e),n=t.pieces.get(o);return!!s&&(!n||n.color!==t.movable.color)&&t.predroppable.enabled&&(s.role!=="pawn"||o[1]!=="1"&&o[1]!=="8")&&t.movable.color===s.color&&t.turnColor!==s.color}function jo(t,e){const o=t.pieces.get(e);return!!o&&t.draggable.enabled&&(t.movable.color==="both"||t.movable.color===o.color&&(t.turnColor===o.color||t.premovable.enabled))}function Vo(t){const e=t.premovable.current;if(!e)return!1;const o=e[0],s=e[1];let n=!1;if(He(t,o,s)){const i=xt(t,o,s);if(i){const a={premove:!0};i!==!0&&(a.captured=i),N(t.movable.events.after,o,s,a),n=!0}}return J(t),n}function Fo(t,e){const o=t.predroppable.current;let s=!1;if(!o)return!1;if(e(o)){const n={role:o.role,color:t.movable.color};We(t,n,o.key)&&(N(t.movable.events.afterNewPiece,o.role,o.key,{premove:!1,predrop:!0}),s=!0)}return ee(t),s}function Ue(t){J(t),ee(t),B(t)}function tt(t){t.movable.color=t.movable.dests=t.animation.current=void 0,Ue(t)}function ie(t,e,o){let s=Math.floor(8*(t[0]-o.left)/o.width);e||(s=7-s);let n=7-Math.floor(8*(t[1]-o.top)/o.height);return e||(n=7-n),s>=0&&s<8&&n>=0&&n<8?K([s,n]):void 0}function Wo(t,e,o,s){const n=C(t),i=bt.filter(l=>St(n[0],n[1],l[0],l[1])||yt(n[0],n[1],l[0],l[1])),a=i.map(l=>wt(K(l),o,s)).map(l=>me(e,l)),[,r]=a.reduce((l,c,f)=>l[0]<c?l:[c,f],[a[0],0]);return K(i[r])}const q=t=>t.orientation==="white",Nt="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR",Ho={p:"pawn",r:"rook",n:"knight",b:"bishop",q:"queen",k:"king"},Qo={pawn:"p",rook:"r",knight:"n",bishop:"b",queen:"q",king:"k"};function qt(t){t==="start"&&(t=Nt);const e=new Map;let o=7,s=0;for(const n of t)switch(n){case" ":case"[":return e;case"/":if(--o,o<0)return e;s=0;break;case"~":{const i=e.get(K([s-1,o]));i&&(i.promoted=!0);break}default:{const i=n.charCodeAt(0);if(i<57)s+=i-48;else{const a=n.toLowerCase();e.set(K([s,o]),{role:Ho[a],color:n===a?"black":"white"}),++s}}}return e}function Uo(t){return Mo.map(e=>Ke.map(o=>{const s=t.get(o+e);if(s){let n=Qo[s.role];return s.color==="white"&&(n=n.toUpperCase()),s.promoted&&(n+="~"),n}else return"1"}).join("")).join("/").replace(/1{2,}/g,e=>e.length.toString())}function Lt(t,e){e.animation&&(Ge(t.animation,e.animation),(t.animation.duration||0)<70&&(t.animation.enabled=!1))}function Ot(t,e){var o,s,n;if(!((o=e.movable)===null||o===void 0)&&o.dests&&(t.movable.dests=void 0),!((s=e.drawable)===null||s===void 0)&&s.autoShapes&&(t.drawable.autoShapes=[]),Ge(t,e),e.fen&&(t.pieces=qt(e.fen),t.drawable.shapes=((n=e.drawable)===null||n===void 0?void 0:n.shapes)||[]),"check"in e&&Lo(t,e.check||!1),"lastMove"in e&&!e.lastMove?t.lastMove=void 0:e.lastMove&&(t.lastMove=e.lastMove),t.selected&&Tt(t,t.selected),Lt(t,e),!t.movable.rookCastle&&t.movable.dests){const i=t.movable.color==="white"?"1":"8",a="e"+i,r=t.movable.dests.get(a),l=t.pieces.get(a);if(!r||!l||l.role!=="king")return;t.movable.dests.set(a,r.filter(c=>!(c==="a"+i&&r.includes("c"+i))&&!(c==="h"+i&&r.includes("g"+i))))}}function Ge(t,e){for(const o in e)Object.prototype.hasOwnProperty.call(e,o)&&(Object.prototype.hasOwnProperty.call(t,o)&&ot(t[o])&&ot(e[o])?Ge(t[o],e[o]):t[o]=e[o])}function ot(t){if(typeof t!="object"||t===null)return!1;const e=Object.getPrototypeOf(t);return e===Object.prototype||e===null}const te=(t,e)=>e.animation.enabled?Zo(t,e):Y(t,e);function Y(t,e){const o=t(e);return e.dom.redraw(),o}const Te=(t,e)=>({key:t,pos:C(t),piece:e}),Go=(t,e)=>e.sort((o,s)=>me(t.pos,o.pos)-me(t.pos,s.pos))[0];function zo(t,e){const o=new Map,s=[],n=new Map,i=[],a=[],r=new Map;let l,c,f;for(const[u,d]of t)r.set(u,Te(u,d));for(const u of je)l=e.pieces.get(u),c=r.get(u),l?c?Le(l,c.piece)||(i.push(c),a.push(Te(u,l))):a.push(Te(u,l)):c&&i.push(c);for(const u of a)c=Go(u,i.filter(d=>Le(u.piece,d.piece))),c&&(f=[c.pos[0]-u.pos[0],c.pos[1]-u.pos[1]],o.set(u.key,f.concat(f)),s.push(c.key));for(const u of i)s.includes(u.key)||n.set(u.key,u.piece);return{anims:o,fadings:n}}function $t(t,e){const o=t.animation.current;if(o===void 0){t.dom.destroyed||t.dom.redrawNow();return}const s=1-(e-o.start)*o.frequency;if(s<=0)t.animation.current=void 0,t.dom.redrawNow();else{const n=Yo(s);for(const i of o.plan.anims.values())i[2]=i[0]*n,i[3]=i[1]*n;t.dom.redrawNow(!0),requestAnimationFrame((i=performance.now())=>$t(t,i))}}function Zo(t,e){const o=new Map(e.pieces),s=t(e),n=zo(o,e);if(n.anims.size||n.fadings.size){const i=e.animation.current&&e.animation.current.start;e.animation.current={start:performance.now(),frequency:1/e.animation.duration,plan:n},i||$t(e,performance.now())}else e.dom.redraw();return s}const Yo=t=>t<.5?4*t*t*t:(t-1)*(2*t-2)*(2*t-2)+1,Xo=["green","red","blue","yellow"];function Jo(t,e){if(e.touches&&e.touches.length>1)return;e.stopPropagation(),e.preventDefault(),e.ctrlKey?B(t):Ue(t);const o=ne(e),s=ie(o,q(t),t.dom.bounds());s&&(t.drawable.current={orig:s,pos:o,brush:ss(e),snapToValidMove:t.drawable.defaultSnapToValidMove},Dt(t))}function Dt(t){requestAnimationFrame(()=>{const e=t.drawable.current;if(e){const o=ie(e.pos,q(t),t.dom.bounds());o||(e.snapToValidMove=!1);const s=e.snapToValidMove?Wo(e.orig,e.pos,q(t),t.dom.bounds()):o;s!==e.mouseSq&&(e.mouseSq=s,e.dest=s!==e.orig?s:void 0,t.dom.redrawNow()),Dt(t)}})}function es(t,e){t.drawable.current&&(t.drawable.current.pos=ne(e))}function ts(t){const e=t.drawable.current;e&&(e.mouseSq&&ns(t.drawable,e),Rt(t))}function Rt(t){t.drawable.current&&(t.drawable.current=void 0,t.dom.redraw())}function os(t){t.drawable.shapes.length&&(t.drawable.shapes=[],t.dom.redraw(),Kt(t.drawable))}function ss(t){var e;const o=(t.shiftKey||t.ctrlKey)&&_t(t),s=t.altKey||t.metaKey||((e=t.getModifierState)===null||e===void 0?void 0:e.call(t,"AltGraph"));return Xo[(o?1:0)+(s?2:0)]}function ns(t,e){const o=n=>n.orig===e.orig&&n.dest===e.dest,s=t.shapes.find(o);s&&(t.shapes=t.shapes.filter(n=>!o(n))),(!s||s.brush!==e.brush)&&t.shapes.push({orig:e.orig,dest:e.dest,brush:e.brush}),Kt(t)}function Kt(t){t.onChange&&t.onChange(t.shapes)}function is(t,e){if(!(t.trustAllEvents||e.isTrusted)||e.button!==void 0&&e.button!==0||e.touches&&e.touches.length>1)return;const o=t.dom.bounds(),s=ne(e),n=ie(s,q(t),o);if(!n)return;const i=t.pieces.get(n),a=t.selected;if(!a&&t.drawable.enabled&&(t.drawable.eraseOnClick||!i||i.color!==t.turnColor)&&os(t),e.cancelable!==!1&&(!e.touches||t.blockTouchScroll||i||a||rs(t,s)))e.preventDefault();else if(e.touches)return;const r=!!t.premovable.current,l=!!t.predroppable.current;t.stats.ctrlKey=e.ctrlKey,t.selected&&He(t,t.selected,n)?te(u=>Oe(u,n),t):Oe(t,n);const c=t.selected===n,f=jt(t,n);if(i&&f&&c&&jo(t,n)){t.draggable.current={orig:n,piece:i,origPos:s,pos:s,started:t.draggable.autoDistance&&t.stats.dragged,element:f,previouslySelected:a,originTarget:e.target,keyHasChanged:!1},f.cgDragging=!0,f.classList.add("dragging");const u=t.dom.elements.ghost;u&&(u.className=`ghost ${i.color} ${i.role}`,W(u,be(o)(C(n),q(t))),Fe(u,!0)),ze(t)}else r&&J(t),l&&ee(t);t.dom.redraw()}function rs(t,e){const o=q(t),s=t.dom.bounds(),n=Math.pow(s.width/8,2);for(const i of t.pieces.keys()){const a=wt(i,o,s);if(me(a,e)<=n)return!0}return!1}function as(t,e,o,s){const n="a0";t.pieces.set(n,e),t.dom.redraw();const i=ne(o);t.draggable.current={orig:n,piece:e,origPos:i,pos:i,started:!0,element:()=>jt(t,n),originTarget:o.target,newPiece:!0,force:!!s,keyHasChanged:!1},ze(t)}function ze(t){requestAnimationFrame(()=>{var e;const o=t.draggable.current;if(!o)return;!((e=t.animation.current)===null||e===void 0)&&e.plan.anims.has(o.orig)&&(t.animation.current=void 0);const s=t.pieces.get(o.orig);if(!s||!Le(s,o.piece))Se(t);else if(!o.started&&me(o.pos,o.origPos)>=Math.pow(t.draggable.distance,2)&&(o.started=!0),o.started){if(typeof o.element=="function"){const i=o.element();if(!i)return;i.cgDragging=!0,i.classList.add("dragging"),o.element=i}const n=t.dom.bounds();W(o.element,[o.pos[0]-n.left-n.width/16,o.pos[1]-n.top-n.height/16]),o.keyHasChanged||(o.keyHasChanged=o.orig!==ie(o.pos,q(t),n))}ze(t)})}function ls(t,e){t.draggable.current&&(!e.touches||e.touches.length<2)&&(t.draggable.current.pos=ne(e))}function cs(t,e){const o=t.draggable.current;if(!o)return;if(e.type==="touchend"&&e.cancelable!==!1&&e.preventDefault(),e.type==="touchend"&&o.originTarget!==e.target&&!o.newPiece){t.draggable.current=void 0;return}J(t),ee(t);const s=ne(e)||o.pos,n=ie(s,q(t),t.dom.bounds());n&&o.started&&o.orig!==n?o.newPiece?At(t,o.orig,n,o.force):(t.stats.ctrlKey=e.ctrlKey,Pt(t,o.orig,n)&&(t.stats.dragged=!0)):o.newPiece?t.pieces.delete(o.orig):t.draggable.deleteOnDropOff&&!n&&(t.pieces.delete(o.orig),N(t.events.change)),(o.orig===o.previouslySelected||o.keyHasChanged)&&(o.orig===n||!n)?B(t):t.selectable.enabled||B(t),Bt(t),t.draggable.current=void 0,t.dom.redraw()}function Se(t){const e=t.draggable.current;e&&(e.newPiece&&t.pieces.delete(e.orig),t.draggable.current=void 0,B(t),Bt(t),t.dom.redraw())}function Bt(t){const e=t.dom.elements;e.ghost&&Fe(e.ghost,!1)}function jt(t,e){let o=t.dom.elements.board.firstChild;for(;o;){if(o.cgKey===e&&o.tagName==="PIECE")return o;o=o.nextSibling}}function hs(t,e){t.exploding={stage:1,keys:e},t.dom.redraw(),setTimeout(()=>{st(t,2),setTimeout(()=>st(t,void 0),120)},120)}function st(t,e){t.exploding&&(e?t.exploding.stage=e:t.exploding=void 0,t.dom.redraw())}function ds(t,e){function o(){No(t),e()}return{set(s){s.orientation&&s.orientation!==t.orientation&&o(),Lt(t,s),(s.fen?te:Y)(n=>Ot(n,s),t)},state:t,getFen:()=>Uo(t.pieces),toggleOrientation:o,setPieces(s){te(n=>qo(n,s),t)},selectSquare(s,n){s?te(i=>Oe(i,s,n),t):t.selected&&(B(t),t.dom.redraw())},move(s,n){te(i=>Mt(i,s,n),t)},newPiece(s,n){te(i=>We(i,s,n),t)},playPremove(){if(t.premovable.current){if(te(Vo,t))return!0;t.dom.redraw()}return!1},playPredrop(s){if(t.predroppable.current){const n=Fo(t,s);return t.dom.redraw(),n}return!1},cancelPremove(){Y(J,t)},cancelPredrop(){Y(ee,t)},cancelMove(){Y(s=>{Ue(s),Se(s)},t)},stop(){Y(s=>{tt(s),Se(s)},t)},explode(s){hs(t,s)},setAutoShapes(s){Y(n=>n.drawable.autoShapes=s,t)},setShapes(s){Y(n=>n.drawable.shapes=s,t)},getKeyAtDomPos(s){return ie(s,q(t),t.dom.bounds())},redrawAll:e,dragNewPiece(s,n,i){as(t,s,n,i)},destroy(){tt(t),t.dom.unbind&&t.dom.unbind(),t.dom.destroyed=!0}}}function us(){return{pieces:qt(Nt),orientation:"white",turnColor:"white",coordinates:!0,ranksPosition:"right",autoCastle:!0,viewOnly:!1,disableContextMenu:!1,addPieceZIndex:!1,blockTouchScroll:!1,pieceKey:!1,trustAllEvents:!1,highlight:{lastMove:!0,check:!0},animation:{enabled:!0,duration:200},movable:{free:!0,color:"both",showDests:!0,events:{},rookCastle:!0},premovable:{enabled:!0,showDests:!0,castle:!0,events:{}},predroppable:{enabled:!1,events:{}},draggable:{enabled:!0,distance:3,autoDistance:!0,showGhost:!0,deleteOnDropOff:!1},dropmode:{active:!1},selectable:{enabled:!0},stats:{dragged:!("ontouchstart"in window)},events:{},drawable:{enabled:!0,visible:!0,defaultSnapToValidMove:!0,eraseOnClick:!0,shapes:[],autoShapes:[],brushes:{green:{key:"g",color:"#15781B",opacity:1,lineWidth:10},red:{key:"r",color:"#882020",opacity:1,lineWidth:10},blue:{key:"b",color:"#003088",opacity:1,lineWidth:10},yellow:{key:"y",color:"#e68f00",opacity:1,lineWidth:10},paleBlue:{key:"pb",color:"#003088",opacity:.4,lineWidth:15},paleGreen:{key:"pg",color:"#15781B",opacity:.4,lineWidth:15},paleRed:{key:"pr",color:"#882020",opacity:.4,lineWidth:15},paleGrey:{key:"pgr",color:"#4a4a4a",opacity:.35,lineWidth:15},purple:{key:"purp",color:"#68217a",opacity:.65,lineWidth:10},pink:{key:"pink",color:"#ee2080",opacity:.5,lineWidth:10},hilite:{key:"hilite",color:"#fff",opacity:1,lineWidth:1}},prevSvgHash:""},hold:Po()}}function ps(){const t=E("defs"),e=T(E("filter"),{id:"cg-filter-blur"});return e.appendChild(T(E("feGaussianBlur"),{stdDeviation:"0.022"})),t.appendChild(e),t}function fs(t,e,o){var s;const n=t.drawable,i=n.current,a=i&&i.mouseSq?i:void 0,r=new Map,l=t.dom.bounds(),c=n.autoShapes.filter(m=>!m.piece);for(const m of n.shapes.concat(c).concat(a?[a]:[])){if(!m.dest)continue;const h=(s=r.get(m.dest))!==null&&s!==void 0?s:new Set,p=Me(Ee(C(m.orig),t.orientation),l),g=Me(Ee(C(m.dest),t.orientation),l);h.add(De(p,g)),r.set(m.dest,h)}const f=n.shapes.concat(c).map(m=>({shape:m,current:!1,hash:nt(m,$e(m.dest,r),!1,l)}));a&&f.push({shape:a,current:!0,hash:nt(a,$e(a.dest,r),!0,l)});const u=f.map(m=>m.hash).join(";");if(u===t.drawable.prevSvgHash)return;t.drawable.prevSvgHash=u;const d=e.querySelector("defs");gs(n,f,d),ms(f,e.querySelector("g"),o.querySelector("g"),m=>_s(t,m,n.brushes,r,l))}function gs(t,e,o){var s;const n=new Map;let i;for(const l of e.filter(c=>c.shape.dest&&c.shape.brush))i=Vt(t.brushes[l.shape.brush],l.shape.modifiers),!((s=l.shape.modifiers)===null||s===void 0)&&s.hilite&&n.set("hilite",t.brushes.hilite),n.set(i.key,i);const a=new Set;let r=o.firstElementChild;for(;r;)a.add(r.getAttribute("cgKey")),r=r.nextElementSibling;for(const[l,c]of n.entries())a.has(l)||o.appendChild(ks(c))}function ms(t,e,o,s){const n=new Map;for(const i of t)n.set(i.hash,!1);for(const i of[e,o]){const a=[];let r=i.firstElementChild,l;for(;r;)l=r.getAttribute("cgHash"),n.has(l)?n.set(l,!0):a.push(r),r=r.nextElementSibling;for(const c of a)i.removeChild(c)}for(const i of t.filter(a=>!n.get(a.hash)))for(const a of s(i))a.isCustom?o.appendChild(a.el):e.appendChild(a.el)}function nt({orig:t,dest:e,brush:o,piece:s,modifiers:n,customSvg:i,label:a},r,l,c){var f,u;return[c.width,c.height,l,t,e,o,r&&"-",s&&bs(s),n&&vs(n),i&&`custom-${it(i.html)},${(u=(f=i.center)===null||f===void 0?void 0:f[0])!==null&&u!==void 0?u:"o"}`,a&&`label-${it(a.text)}`].filter(d=>d).join(",")}function bs(t){return[t.color,t.role,t.scale].filter(e=>e).join(",")}function vs(t){return[t.lineWidth,t.hilite&&"*"].filter(e=>e).join(",")}function it(t){let e=0;for(let o=0;o<t.length;o++)e=(e<<5)-e+t.charCodeAt(o)>>>0;return e.toString()}function _s(t,{shape:e,current:o,hash:s},n,i,a){var r,l;const c=Me(Ee(C(e.orig),t.orientation),a),f=e.dest?Me(Ee(C(e.dest),t.orientation),a):c,u=e.brush&&Vt(n[e.brush],e.modifiers),d=i.get(e.dest),m=[];if(u){const h=T(E("g"),{cgHash:s});m.push({el:h}),c[0]!==f[0]||c[1]!==f[1]?h.appendChild(ys(e,u,c,f,o,$e(e.dest,i))):h.appendChild(ws(n[e.brush],c,o,a))}if(e.label){const h=e.label;(r=h.fill)!==null&&r!==void 0||(h.fill=e.brush&&n[e.brush].color);const p=e.brush?void 0:"tr";m.push({el:Cs(h,s,c,f,d,p),isCustom:!0})}if(e.customSvg){const h=(l=e.customSvg.center)!==null&&l!==void 0?l:"orig",[p,g]=h==="label"?Wt(c,f,d).map(b=>b-.5):h==="dest"?f:c,w=T(E("g"),{transform:`translate(${p},${g})`,cgHash:s});w.innerHTML=`<svg width="1" height="1" viewBox="0 0 100 100">${e.customSvg.html}</svg>`,m.push({el:w,isCustom:!0})}return m}function ws(t,e,o,s){const n=Ss(),i=(s.width+s.height)/(4*Math.max(s.width,s.height));return T(E("circle"),{stroke:t.color,"stroke-width":n[o?0:1],fill:"none",opacity:Ft(t,o),cx:e[0],cy:e[1],r:i-n[1]/2})}function ys(t,e,o,s,n,i){var a;function r(f){var u;const d=Ms(i&&!n),m=s[0]-o[0],h=s[1]-o[1],p=Math.atan2(h,m),g=Math.cos(p)*d,w=Math.sin(p)*d;return T(E("line"),{stroke:f?"white":e.color,"stroke-width":Es(e,n)+(f?.04:0),"stroke-linecap":"round","marker-end":`url(#arrowhead-${f?"hilite":e.key})`,opacity:!((u=t.modifiers)===null||u===void 0)&&u.hilite?1:Ft(e,n),x1:o[0],y1:o[1],x2:s[0]-g,y2:s[1]-w})}if(!(!((a=t.modifiers)===null||a===void 0)&&a.hilite))return r(!1);const l=E("g"),c=T(E("g"),{filter:"url(#cg-filter-blur)"});return c.appendChild(xs(o,s)),c.appendChild(r(!0)),l.appendChild(c),l.appendChild(r(!1)),l}function ks(t){const e=T(E("marker"),{id:"arrowhead-"+t.key,orient:"auto",overflow:"visible",markerWidth:4,markerHeight:4,refX:t.key==="hilite"?1.86:2.05,refY:2});return e.appendChild(T(E("path"),{d:"M0,0 V4 L3,2 Z",fill:t.color})),e.setAttribute("cgKey",t.key),e}function Cs(t,e,o,s,n,i){var a;const r=.4*.75**t.text.length,l=Wt(o,s,n),c=i==="tr"?.4:0,f=T(E("g"),{transform:`translate(${l[0]+c},${l[1]-c})`,cgHash:e});f.appendChild(T(E("circle"),{r:.4/2,"fill-opacity":i?1:.8,"stroke-opacity":i?1:.7,"stroke-width":.03,fill:(a=t.fill)!==null&&a!==void 0?a:"#666",stroke:"white"}));const u=T(E("text"),{"font-size":r,"font-family":"Noto Sans","text-anchor":"middle",fill:"white",y:.13*.75**t.text.length});return u.innerHTML=t.text,f.appendChild(u),f}function Ee(t,e){return e==="white"?t:[7-t[0],7-t[1]]}function $e(t,e){return(t&&e.has(t)&&e.get(t).size>1)===!0}function E(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function T(t,e){for(const o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.setAttribute(o,e[o]);return t}function Vt(t,e){return e?{color:t.color,opacity:Math.round(t.opacity*10)/10,lineWidth:Math.round(e.lineWidth||t.lineWidth),key:[t.key,e.lineWidth].filter(o=>o).join("")}:t}function Ss(){return[3/64,4/64]}function Es(t,e){return(t.lineWidth||10)*(e?.85:1)/64}function Ft(t,e){return(t.opacity||1)*(e?.9:1)}function Ms(t){return(t?20:10)/64}function Me(t,e){const o=Math.min(1,e.width/e.height),s=Math.min(1,e.height/e.width);return[(t[0]-3.5)*o,(3.5-t[1])*s]}function xs(t,e){const o={from:[Math.floor(Math.min(t[0],e[0])),Math.floor(Math.min(t[1],e[1]))],to:[Math.ceil(Math.max(t[0],e[0])),Math.ceil(Math.max(t[1],e[1]))]};return T(E("rect"),{x:o.from[0],y:o.from[1],width:o.to[0]-o.from[0],height:o.to[1]-o.from[1],fill:"none",stroke:"none"})}function De(t,e,o=!0){const s=Math.atan2(e[1]-t[1],e[0]-t[0])+Math.PI;return o?(Math.round(s*8/Math.PI)+16)%16:s}function Ps(t,e){return Math.sqrt([t[0]-e[0],t[1]-e[1]].reduce((o,s)=>o+s*s,0))}function Wt(t,e,o){let s=Ps(t,e);const n=De(t,e,!1);if(o&&(s-=33/64,o.size>1)){s-=10/64;const i=De(t,e);(o.has((i+1)%16)||o.has((i+15)%16))&&i&1&&(s-=.4)}return[t[0]-Math.cos(n)*s,t[1]-Math.sin(n)*s].map(i=>i+.5)}function As(t,e){t.innerHTML="",t.classList.add("cg-wrap");for(const l of Eo)t.classList.toggle("orientation-"+l,e.orientation===l);t.classList.toggle("manipulable",!e.viewOnly);const o=G("cg-container");t.appendChild(o);const s=G("cg-board");o.appendChild(s);let n,i,a;if(e.drawable.visible&&(n=T(E("svg"),{class:"cg-shapes",viewBox:"-4 -4 8 8",preserveAspectRatio:"xMidYMid slice"}),n.appendChild(ps()),n.appendChild(E("g")),i=T(E("svg"),{class:"cg-custom-svgs",viewBox:"-3.5 -3.5 8 8",preserveAspectRatio:"xMidYMid slice"}),i.appendChild(E("g")),a=G("cg-auto-pieces"),o.appendChild(n),o.appendChild(i),o.appendChild(a)),e.coordinates){const l=e.orientation==="black"?" black":"",c=e.ranksPosition==="left"?" left":"";o.appendChild(rt(Be,"ranks"+l+c)),o.appendChild(rt(Ke,"files"+l))}let r;return e.draggable.enabled&&e.draggable.showGhost&&(r=G("piece","ghost"),Fe(r,!1),o.appendChild(r)),{board:s,container:o,wrap:t,ghost:r,svg:n,customSvg:i,autoPieces:a}}function rt(t,e){const o=G("coords",e);let s;for(const n of t)s=G("coord"),s.textContent=n,o.appendChild(s);return o}function Ts(t,e){if(!t.dropmode.active)return;J(t),ee(t);const o=t.dropmode.piece;if(o){t.pieces.set("a0",o);const s=ne(e),n=s&&ie(s,q(t),t.dom.bounds());n&&At(t,"a0",n)}t.dom.redraw()}function Is(t,e){const o=t.dom.elements.board;if("ResizeObserver"in window&&new ResizeObserver(e).observe(t.dom.elements.wrap),(t.disableContextMenu||t.drawable.enabled)&&o.addEventListener("contextmenu",n=>n.preventDefault()),t.viewOnly)return;const s=qs(t);o.addEventListener("touchstart",s,{passive:!1}),o.addEventListener("mousedown",s,{passive:!1})}function Ns(t,e){const o=[];if("ResizeObserver"in window||o.push(he(document.body,"chessground.resize",e)),!t.viewOnly){const s=at(t,ls,es),n=at(t,cs,ts);for(const a of["touchmove","mousemove"])o.push(he(document,a,s));for(const a of["touchend","mouseup"])o.push(he(document,a,n));const i=()=>t.dom.bounds.clear();o.push(he(document,"scroll",i,{capture:!0,passive:!0})),o.push(he(window,"resize",i,{passive:!0}))}return()=>o.forEach(s=>s())}function he(t,e,o,s){return t.addEventListener(e,o,s),()=>t.removeEventListener(e,o,s)}const qs=t=>e=>{t.draggable.current?Se(t):t.drawable.current?Rt(t):e.shiftKey||_t(e)?t.drawable.enabled&&Jo(t,e):t.viewOnly||(t.dropmode.active?Ts(t,e):is(t,e))},at=(t,e,o)=>s=>{t.drawable.current?t.drawable.enabled&&o(t,s):t.viewOnly||e(t,s)};function Ls(t){const e=q(t),o=be(t.dom.bounds()),s=t.dom.elements.board,n=t.pieces,i=t.animation.current,a=i?i.plan.anims:new Map,r=i?i.plan.fadings:new Map,l=t.draggable.current,c=$s(t),f=new Set,u=new Set,d=new Map,m=new Map;let h,p,g,w,b,S,D,I,re,H;for(p=s.firstChild;p;){if(h=p.cgKey,Ht(p))if(g=n.get(h),b=a.get(h),S=r.get(h),w=p.cgPiece,p.cgDragging&&(!l||l.orig!==h)&&(p.classList.remove("dragging"),W(p,o(C(h),e)),p.cgDragging=!1),!S&&p.cgFading&&(p.cgFading=!1,p.classList.remove("fading")),g){if(b&&p.cgAnimating&&w===de(g)){const k=C(h);k[0]+=b[2],k[1]+=b[3],p.classList.add("anim"),W(p,o(k,e))}else p.cgAnimating&&(p.cgAnimating=!1,p.classList.remove("anim"),W(p,o(C(h),e)),t.addPieceZIndex&&(p.style.zIndex=Ie(C(h),e)));w===de(g)&&(!S||!p.cgFading)?f.add(h):S&&w===de(S)?(p.classList.add("fading"),p.cgFading=!0):Ne(d,w,p)}else Ne(d,w,p);else if(Qt(p)){const k=p.className;c.get(h)===k?u.add(h):Ne(m,k,p)}p=p.nextSibling}for(const[k,le]of c)if(!u.has(k)){re=m.get(le),H=re&&re.pop();const V=o(C(k),e);if(H)H.cgKey=k,W(H,V);else{const F=G("square",le);F.cgKey=k,W(F,V),s.insertBefore(F,s.firstChild)}}for(const[k,le]of n)if(b=a.get(k),!f.has(k))if(D=d.get(de(le)),I=D&&D.pop(),I){I.cgKey=k,I.cgFading&&(I.classList.remove("fading"),I.cgFading=!1);const V=C(k);t.addPieceZIndex&&(I.style.zIndex=Ie(V,e)),b&&(I.cgAnimating=!0,I.classList.add("anim"),V[0]+=b[2],V[1]+=b[3]),W(I,o(V,e))}else{const V=de(le),F=G("piece",V),ve=C(k);F.cgPiece=V,F.cgKey=k,b&&(F.cgAnimating=!0,ve[0]+=b[2],ve[1]+=b[3]),W(F,o(ve,e)),t.addPieceZIndex&&(F.style.zIndex=Ie(ve,e)),s.appendChild(F)}for(const k of d.values())ct(t,k);for(const k of m.values())ct(t,k)}function Os(t){const e=q(t),o=be(t.dom.bounds());let s=t.dom.elements.board.firstChild;for(;s;)(Ht(s)&&!s.cgAnimating||Qt(s))&&W(s,o(C(s.cgKey),e)),s=s.nextSibling}function lt(t){var e,o;const s=t.dom.elements.wrap.getBoundingClientRect(),n=t.dom.elements.container,i=s.height/s.width,a=Math.floor(s.width*window.devicePixelRatio/8)*8/window.devicePixelRatio,r=a*i;n.style.width=a+"px",n.style.height=r+"px",t.dom.bounds.clear(),(e=t.addDimensionsCssVarsTo)===null||e===void 0||e.style.setProperty("--cg-width",a+"px"),(o=t.addDimensionsCssVarsTo)===null||o===void 0||o.style.setProperty("--cg-height",r+"px")}const Ht=t=>t.tagName==="PIECE",Qt=t=>t.tagName==="SQUARE";function ct(t,e){for(const o of e)t.dom.elements.board.removeChild(o)}function Ie(t,e){const o=t[1];return`${e?10-o:3+o}`}const de=t=>`${t.color} ${t.role}`;function $s(t){var e,o,s;const n=new Map;if(t.lastMove&&t.highlight.lastMove)for(const r of t.lastMove)Q(n,r,"last-move");if(t.check&&t.highlight.check&&Q(n,t.check,"check"),t.selected&&(Q(n,t.selected,"selected"),t.movable.showDests)){const r=(e=t.movable.dests)===null||e===void 0?void 0:e.get(t.selected);if(r)for(const c of r)Q(n,c,"move-dest"+(t.pieces.has(c)?" oc":""));const l=(s=(o=t.premovable.customDests)===null||o===void 0?void 0:o.get(t.selected))!==null&&s!==void 0?s:t.premovable.dests;if(l)for(const c of l)Q(n,c,"premove-dest"+(t.pieces.has(c)?" oc":""))}const i=t.premovable.current;if(i)for(const r of i)Q(n,r,"current-premove");else t.predroppable.current&&Q(n,t.predroppable.current.key,"current-premove");const a=t.exploding;if(a)for(const r of a.keys)Q(n,r,"exploding"+a.stage);return t.highlight.custom&&t.highlight.custom.forEach((r,l)=>{Q(n,l,r)}),n}function Q(t,e,o){const s=t.get(e);s?t.set(e,`${s} ${o}`):t.set(e,o)}function Ne(t,e,o){const s=t.get(e);s?s.push(o):t.set(e,[o])}function Ds(t,e,o){const s=new Map,n=[];for(const r of t)s.set(r.hash,!1);let i=e.firstElementChild,a;for(;i;)a=i.getAttribute("cgHash"),s.has(a)?s.set(a,!0):n.push(i),i=i.nextElementSibling;for(const r of n)e.removeChild(r);for(const r of t)s.get(r.hash)||e.appendChild(o(r))}function Rs(t,e){const o=t.drawable.autoShapes.filter(s=>s.piece).map(s=>({shape:s,hash:js(s),current:!1}));Ds(o,e,s=>Bs(t,s,t.dom.bounds()))}function Ks(t){var e;const o=q(t),s=be(t.dom.bounds());let n=(e=t.dom.elements.autoPieces)===null||e===void 0?void 0:e.firstChild;for(;n;)vt(n,s(C(n.cgKey),o),n.cgScale),n=n.nextSibling}function Bs(t,{shape:e,hash:o},s){var n,i,a;const r=e.orig,l=(n=e.piece)===null||n===void 0?void 0:n.role,c=(i=e.piece)===null||i===void 0?void 0:i.color,f=(a=e.piece)===null||a===void 0?void 0:a.scale,u=G("piece",`${l} ${c}`);return u.setAttribute("cgHash",o),u.cgKey=r,u.cgScale=f,vt(u,be(s)(C(r),q(t)),f),u}const js=t=>{var e,o,s;return[t.orig,(e=t.piece)===null||e===void 0?void 0:e.role,(o=t.piece)===null||o===void 0?void 0:o.color,(s=t.piece)===null||s===void 0?void 0:s.scale].join(",")};function Vs(t,e){const o=us();Ot(o,e||{});function s(){const n="dom"in o?o.dom.unbind:void 0,i=As(t,o),a=xo(()=>i.board.getBoundingClientRect()),r=f=>{Ls(c),i.autoPieces&&Rs(c,i.autoPieces),!f&&i.svg&&fs(c,i.svg,i.customSvg)},l=()=>{lt(c),Os(c),i.autoPieces&&Ks(c)},c=o;return c.dom={elements:i,bounds:a,redraw:Fs(r),redrawNow:r,unbind:n},c.drawable.prevSvgHash="",lt(c),r(!1),Is(c,l),n||(c.dom.unbind=Ns(c,l)),c.events.insert&&c.events.insert(i),c}return ds(s(),s)}function Fs(t){let e=!1;return()=>{e||(e=!0,requestAnimationFrame(()=>{t(),e=!1}))}}class Ws{constructor(e,o,s,n){P(this,"game");P(this,"board");P(this,"boardState");P(this,"props");P(this,"emit");this.boardState=o,this.props=s,this.emit=n,this.game=new vo,this.board=Vs(e),this.resetBoard()}updateGameState({updateFen:e=!0}={}){this.boardState.historyViewerState.isEnabled||(e&&this.board.set({fen:this.game.fen()}),this.board.state.turnColor=this.getTurnColor(),this.board.state.movable.free?(this.board.state.movable.color="both",this.board.state.movable.dests=new Map):(this.board.state.movable.color=this.props.playerColor||this.board.state.turnColor,this.board.state.movable.dests=et(this.game)),this.displayInCheck(this.game.inCheck(),this.board.state.turnColor),this.boardState.showThreats&&this.drawMoves()),this.emitEvents()}displayInCheck(e,o){if(e){for(const[s,n]of this.board.state.pieces)if(n.role==="king"&&n.color===o){this.board.state.check=s;return}}else this.board.state.check=void 0}emitEvents(){this.game.inCheck()&&this.emit(this.game.isCheckmate()?"checkmate":"check",this.board.state.turnColor),this.game.isDraw()&&this.emit("draw"),this.game.isStalemate()&&this.emit("stalemate")}async changeTurn(e,o,s){let n;wo(o,this.game.get(e))&&(n=await new Promise(i=>{this.boardState.promotionDialogState={isEnabled:!0,color:this.getTurnColor(),callback:i}})),this.move({from:e,to:o,promotion:n})}resetBoard(){this.setConfig(this.props.boardConfig,!0)}undoLastMove(){const e=this.game.undo();if(e!=null&&(this.boardState.historyViewerState.isEnabled&&this.boardState.historyViewerState.plyViewing===this.getCurrentPlyNumber()&&this.stopViewingHistory(),!this.boardState.historyViewerState.isEnabled)){this.board.set({fen:e.before}),this.updateGameState({updateFen:!1});const o=this.getLastMove();this.board.state.lastMove=o?[o==null?void 0:o.from,o==null?void 0:o.to]:void 0}}getMaterialCount(){const e=this.board.state.pieces,o={pawn:1,knight:3,bishop:3,rook:5,queen:9,king:0},s={materialWhite:0,materialBlack:0,materialDiff:0};for(const n of e)n[1].color==="white"?s.materialWhite+=o[n[1].role]:s.materialBlack+=o[n[1].role];return s.materialDiff=s.materialWhite-s.materialBlack,s}getCapturedPieces(){const e={white:[],black:[]};for(const{color:o,captured:s}of this.getHistory(!0))s&&e[we(o)].push(s);return e}toggleOrientation(){this.board.toggleOrientation()}drawMoves(){this.boardState.showThreats=!0,this.board.setShapes(_o(this.game.moves({verbose:!0})))}hideMoves(){this.boardState.showThreats=!1,this.board.setShapes([])}drawMove(e,o,s){this.board.setShapes([{orig:e,dest:o,brush:s}])}toggleMoves(){this.boardState.showThreats?this.hideMoves():this.drawMoves()}async getOpeningName(){var e;try{const o=this.game.history({verbose:!0}).map(s=>s.lan).join(",");return((e=(await(await fetch(`https://explorer.lichess.ovh/masters?play=${o}`)).json()).opening)==null?void 0:e.name)??null}catch{return null}}move(e){let o;try{o=this.game.move(e)}catch{return typeof e=="object"&&this.board.state.movable.free&&(this.board.move(e.from,e.to),this.updateGameState({updateFen:!1})),!1}return this.emit("move",o),o!=null&&o.promotion&&this.emit("promotion",{color:we(o.color),promotedTo:o.promotion.toUpperCase(),sanMove:o.san}),this.boardState.historyViewerState.isEnabled||(this.board.move(o.from,o.to),(o.flags==="e"||o!=null&&o.promotion)&&setTimeout(()=>this.board.set({fen:o.after}),this.board.state.animation.current?this.board.state.animation.duration:0),this.updateGameState({updateFen:!1}),Zt(this.board.playPremove)),!0}getTurnColor(){return we(this.game.turn())}getPossibleMoves(){return et(this.game)}getCurrentTurnNumber(){return this.game.moveNumber()}getCurrentPlyNumber(){return 2*this.getCurrentTurnNumber()-(this.getTurnColor()==="black"?1:2)}getLastMove(){return this.game.history({verbose:!0}).at(-1)}getHistory(e=!1){return this.game.history({verbose:e})}getFen(){return this.game.fen()}getBoardPosition(){return this.game.board()}getPgn(){return this.game.pgn()}getIsGameOver(){return this.game.isGameOver()}getIsCheckmate(){return this.game.isCheckmate()}getIsCheck(){return this.game.isCheck()}getIsStalemate(){return this.game.isStalemate()}getIsDraw(){return this.game.isDraw()}getIsThreefoldRepetition(){return this.game.isThreefoldRepetition()}getIsInsufficientMaterial(){return this.game.isInsufficientMaterial()}getSquareColor(e){return this.game.squareColor(e)}getSquare(e){return this.game.get(e)}setPosition(e){this.game.load(e),this.boardState.historyViewerState={isEnabled:!1},this.updateGameState()}putPiece(e,o){if(this.board.state.movable.free){const s=this.board.state.pieces;return s.set(o,{color:e.color==="w"?"white":"black",role:yo[e.type]}),this.board.setPieces(s),!0}else{const s=this.game.put(e,o);return s&&this.updateGameState(),s}}clearBoard(){this.game.clear(),this.boardState.historyViewerState={isEnabled:!1},this.updateGameState()}setShapes(e){this.board.setShapes(e)}loadPgn(e){this.game.loadPgn(e),this.boardState.historyViewerState={isEnabled:!1},this.updateGameState();const o=this.getLastMove();o&&this.board.set({lastMove:[o.from,o.to]})}getPgnInfo(){return this.game.header()}setPgnInfo(e){return this.game.header(...Object.entries(e).flat())}setConfig(e,o=!1){var i;if(o&&(e=gt(So,e),this.board.state.selected=void 0),((i=e.movable)==null?void 0:i.events)&&"after"in e.movable.events){const a=e.movable.events.after;e.movable.events.after=a?async(...r)=>{await this.changeTurn(...r),a(...r)}:this.changeTurn.bind(this)}const{fen:s,...n}=e;this.board.set(n),s&&this.setPosition(s),this.board.redrawAll()}viewHistory(e){const o=this.getHistory(!0);if(e<0||e>o.length)return;const s=this.board.state.animation.enabled&&(this.boardState.historyViewerState.isEnabled&&Math.abs(this.boardState.historyViewerState.plyViewing-e)!==1||!this.boardState.historyViewerState.isEnabled&&e!==o.length-1);if(s&&this.board.set({animation:{enabled:!1}}),e<o.length)this.boardState.historyViewerState.isEnabled?this.boardState.historyViewerState.plyViewing=e:this.boardState.historyViewerState={isEnabled:!0,plyViewing:e,viewOnly:this.board.state.viewOnly},this.board.set({fen:o[e].before,viewOnly:!0,lastMove:e>0?[o[e-1].from,o[e-1].to]:void 0,selected:void 0}),this.displayInCheck(e>0?"+#".includes(o[e-1].san.at(-1)):!1,we(o[e].color)),this.board.cancelPremove();else if(this.boardState.historyViewerState.isEnabled){const n=o.at(-1);this.board.set({fen:n.after,viewOnly:this.boardState.historyViewerState.viewOnly,lastMove:[n.from,n.to]}),this.boardState.historyViewerState={isEnabled:!1},this.updateGameState({updateFen:!1})}s&&this.board.set({animation:{enabled:!0}})}stopViewingHistory(){this.boardState.historyViewerState.isEnabled&&this.viewHistory(this.getCurrentPlyNumber())}viewStart(){this.viewHistory(0)}viewNext(){this.boardState.historyViewerState.isEnabled&&this.viewHistory(this.boardState.historyViewerState.plyViewing+1)}viewPrevious(){const e=this.boardState.historyViewerState.isEnabled?this.boardState.historyViewerState.plyViewing:this.getCurrentPlyNumber();this.viewHistory(e-1)}}const Hs={class:"main-board"},Qs=ht({__name:"TheChessboard",props:{boardConfig:{default:()=>({})},playerColor:{},reactiveConfig:{type:Boolean,default:!1}},emits:["boardCreated","check","checkmate","stalemate","draw","promotion","move"],setup(t,{emit:e}){const o=t,s=ae(null),n=Ze({showThreats:!1,promotionDialogState:{isEnabled:!1},historyViewerState:{isEnabled:!1}});return dt(()=>{if(s.value==null)throw new Error("vue3-chessboard: Failed to mount board.");const i=new Ws(s.value,n,o,e);if(e("boardCreated",i),o.reactiveConfig){let a=Ce(o.boardConfig);zt(Ze(o.boardConfig),r=>{i.setConfig(mt(a,r)),a=Ce(r)})}}),(i,a)=>($(),j("section",{class:Re(["main-wrap",{disabledBoard:n.promotionDialogState.isEnabled,viewingHistory:n.historyViewerState.isEnabled}])},[y("div",Hs,[n.promotionDialogState.isEnabled?($(),ut(oo,{key:0,state:n.promotionDialogState,onPromotionSelected:a[0]||(a[0]=r=>n.promotionDialogState={isEnabled:!1})},null,8,["state"])):pt("",!0),y("div",{ref_key:"boardElement",ref:s},null,512)])],2))}}),Us={id:"modalEl",tabindex:"-1","aria-hidden":"true",class:"fixed top-0 left-0 right-0 z-50 hidden w-full p-4 overflow-x-hidden overflow-y-auto md:inset-0 h-[calc(100%-1rem)] max-h-full"},Gs={class:"relative w-full max-w-[400px] max-h-full"},zs={class:"relative bg-[#414141] ring-accent ring-2 rounded-lg shadow dark:bg-gray-700"},Zs={class:"flex relative items-start justify-between p-5 rounded-t dark:border-gray-600"},Ys={class:"text-xl font-bold text-center w-full text-my-white lg:text-2xl dark:text-white"},Xs=y("svg",{class:"w-3 h-3","aria-hidden":"true",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 14 14"},[y("path",{stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"})],-1),Js=y("span",{class:"sr-only"},"Close modal",-1),en=[Xs,Js],tn={class:"flex justify-center items-center p-6 space-x-2 rounded-b dark:border-gray-600"},on={__name:"WinnerModal",props:{showModal:{type:Boolean,default:!1},winner:{type:String,default:null}},setup(t,{emit:e}){const o=ae(null);dt(()=>{const a=document.getElementById("modalEl"),r={backdrop:"dynamic",backdropClasses:"bg-gray-900/50 dark:bg-gray-900/80 fixed inset-0 z-40",closable:!1};o.value=new Yt(a,r),o.value.toggle()});const s=e;function n(){o.value.hide(),s("rematch")}function i(){o.value.hide(),s("closeModal")}return(a,r)=>($(),j("div",Us,[y("div",Gs,[y("div",zs,[y("div",Zs,[y("h3",Ys,U(t.winner==="b"?a.$t("You lost!"):a.$t("You Won!")),1),y("button",{type:"button",onClick:i,class:"text-my-white absolute top-[50%] translate-y-[calc(-50%)] right-5 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm w-8 h-8 ml-auto inline-flex justify-center items-center dark:hover:bg-gray-600 dark:hover:text-white"},en)]),y("div",tn,[y("button",{type:"button",onClick:n,class:"text-white bg-accent hover:bg-accent/80 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800"},U(a.$t("New game")),1),y("button",{type:"button",onClick:i,class:"text-gray-500 bg-white hover:bg-gray-100 focus:ring-4 focus:outline-none focus:ring-blue-300 rounded-lg text-sm font-medium px-5 py-2.5 hover:text-gray-900 focus:z-10 dark:bg-gray-700 dark:text-gray-300 dark:border-gray-500 dark:hover:text-white dark:hover:bg-gray-600"},U(a.$t("Close")),1)])])])]))}};class sn{constructor(e){this._stockfish,this._boardApi=e,this.bestMove,this.engineName;const o=typeof WebAssembly=="object"&&WebAssembly.validate(Uint8Array.of(0,97,115,109,1,0,0,0));this._stockfish=new Worker(o?"stockfish.wasm.js":"stockfish.js"),this._setupListeners(),this._stockfish.postMessage("uci")}_setupListeners(){this._stockfish.addEventListener("message",e=>this._handleEngineStdout(e)),this._stockfish.addEventListener("error",e=>console.error(e)),this._stockfish.addEventListener("messageerror",e=>console.error(e))}_handleEngineStdout(e){const o=e.data.split(" ");if(o[0]==="uciok"){this._setOption("UCI_AnalyseMode","true"),this._setOption("Analysis Contempt","Off"),this._stockfish.postMessage("ucinewgame"),this._stockfish.postMessage("isready");return}if(o[0]==="readyok"){this._stockfish.postMessage("go movetime 1500");return}o[0]==="bestmove"&&o[1]&&o[1]!==this.bestMove&&(this.bestMove=o[1],this._boardApi.getTurnColor()==="black"&&this._boardApi.move({from:this.bestMove.slice(0,2),to:this.bestMove.slice(2,4)}))}_setOption(e,o){this._stockfish.postMessage(`setoption name ${e} value ${o}`)}sendPosition(e){this._stockfish.postMessage(`position startpos moves ${e}`),this._stockfish.postMessage("go movetime 500")}}const nn={class:"grid gap-[20px]"},rn={class:"flex items-baseline gap-[3px]"},an={class:"py-[4px]"},ln={id:"chess-move-notation",class:"max-w-[250px] w-full overflow-x-scroll"},cn={class:"flex items-baseline gap-[3px] moves-holder"},hn={class:"overflow-hidden flex gap-[5px] items-center bg-gray-600 max-w-[300px] min-w-[100px] p-3 rounded-lg"},dn=y("svg",{width:"36",height:"36",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[y("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M12 4C9.79086 4 8 5.79086 8 8C8 10.2091 9.79086 12 12 12C14.2091 12 16 10.2091 16 8C16 5.79086 14.2091 4 12 4ZM15.641 12.7694C17.075 11.673 18 9.94452 18 8C18 4.68629 15.3137 2 12 2C8.68629 2 6 4.68629 6 8C6 9.94452 6.92501 11.673 8.35901 12.7694C7.35354 13.2142 6.4285 13.8436 5.63604 14.636C5.02411 15.248 4.50935 15.939 4.10177 16.6851C3.34966 18.0619 3.65638 19.4657 4.50339 20.4584C5.3188 21.414 6.62502 22 8 22H16C17.375 22 18.6812 21.414 19.4966 20.4584C20.3436 19.4657 20.6503 18.0619 19.8982 16.6851C19.4907 15.939 18.9759 15.248 18.364 14.636C17.5715 13.8436 16.6465 13.2142 15.641 12.7694ZM12 14C10.1435 14 8.36301 14.7375 7.05025 16.0503C6.57425 16.5263 6.17394 17.0637 5.85696 17.6439C5.54999 18.2058 5.64902 18.7198 6.02481 19.1602C6.4322 19.6376 7.16584 20 8 20H16C16.8342 20 17.5678 19.6376 17.9752 19.1602C18.351 18.7198 18.45 18.2058 18.143 17.6439C17.8261 17.0637 17.4258 16.5263 16.9497 16.0503C15.637 14.7375 13.8565 14 12 14Z",fill:"black"})],-1),un={class:"w-fit"},pn={class:"flex overflow-scroll"},fn=["src","alt"],gn={class:"overflow-hidden flex gap-[5px] items-center bg-gray-600 max-w-[300px] min-w-[100px] p-3 rounded-lg"},mn=y("svg",{width:"36",height:"36",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[y("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M12 4C9.79086 4 8 5.79086 8 8C8 10.2091 9.79086 12 12 12C14.2091 12 16 10.2091 16 8C16 5.79086 14.2091 4 12 4ZM15.641 12.7694C17.075 11.673 18 9.94452 18 8C18 4.68629 15.3137 2 12 2C8.68629 2 6 4.68629 6 8C6 9.94452 6.92501 11.673 8.35901 12.7694C7.35354 13.2142 6.4285 13.8436 5.63604 14.636C5.02411 15.248 4.50935 15.939 4.10177 16.6851C3.34966 18.0619 3.65638 19.4657 4.50339 20.4584C5.3188 21.414 6.62502 22 8 22H16C17.375 22 18.6812 21.414 19.4966 20.4584C20.3436 19.4657 20.6503 18.0619 19.8982 16.6851C19.4907 15.939 18.9759 15.248 18.364 14.636C17.5715 13.8436 16.6465 13.2142 15.641 12.7694ZM12 14C10.1435 14 8.36301 14.7375 7.05025 16.0503C6.57425 16.5263 6.17394 17.0637 5.85696 17.6439C5.54999 18.2058 5.64902 18.7198 6.02481 19.1602C6.4322 19.6376 7.16584 20 8 20H16C16.8342 20 17.5678 19.6376 17.9752 19.1602C18.351 18.7198 18.45 18.2058 18.143 17.6439C17.8261 17.0637 17.4258 16.5263 16.9497 16.0503C15.637 14.7375 13.8565 14 12 14Z",fill:"var(--accent-color)"})],-1),bn={class:"flex overflow-scroll"},vn=["src","alt"],_n={class:"flex gap-[40px] justify-center"},kn={__name:"Board",setup(t){const e={coordinates:!0},o=ae(!1),s=ae(null);let n,i;function a(h){n=h,i=new sn(h),i._setOption("Skill Level",10);const p=document.getElementsByTagName("cg-board");p[0].style.background="url(https://i.postimg.cc/j5H70b6C/chessboard.png)",p[0].style.backgroundSize="contain"}const r=ae({});function l(){o.value=!1,f.value=null,n.resetBoard(),r.value={}}function c(h){h==="w"?s.value="w":s.value="b",setTimeout(()=>{o.value=!0},2e3)}const f=ae(null),u=h=>{console.log(n);const p=n.getHistory(!0);f.value=p.map(w=>({san:w.san,color:w.color}));const g=p==null?void 0:p.map(w=>typeof w=="object"?w.lan:w);g&&(i==null||i.sendPosition(g.join(" "))),d(),r.value=n.getCapturedPieces()};function d(){setTimeout(()=>{const h=document.querySelector("#chess-move-notation"),p=document.querySelector(".moves-holder");h.scrollLeft=p.getClientRects()[0].width},1)}const m=()=>{n.undoLastMove(),n.undoLastMove(),r.value=n.getCapturedPieces()};return(h,p)=>($(),j(ue,null,[o.value?($(),ut(on,{key:0,winner:s.value,onCloseModal:p[0]||(p[0]=g=>o.value=!1),onRematch:l},null,8,["winner"])):pt("",!0),y("div",nn,[y("div",rn,[y("span",an,U(h.$t("Moves"))+":",1),y("div",ln,[y("div",cn,[($(!0),j(ue,null,ye(f.value,(g,w)=>($(),j("div",{class:Re(`player-move player-${g.color}`),key:w},U(g.san),3))),128))])])]),y("div",hn,[dn,y("span",un,U(h.$t("Stockfish"))+":",1),y("div",pn,[($(!0),j(ue,null,ye(r.value.black,(g,w)=>($(),j("img",{key:w,src:`/chessboard/w_${g}.svg`,alt:g,class:"w-[30px]"},null,8,fn))),128))])]),Xt(Jt(Qs),{id:"chessboard-id",onBoardCreated:a,"board-config":e,onMove:p[1]||(p[1]=g=>u()),onCheckmate:c}),y("div",gn,[mn,y("span",null,U(h.$t("You"))+":",1),y("div",bn,[($(!0),j(ue,null,ye(r.value.white,(g,w)=>($(),j("img",{key:w,src:`/chessboard/b_${g}.svg`,alt:g,class:"w-[30px]"},null,8,vn))),128))])]),y("div",_n,[y("button",{class:"rounded-[8px] bg-accent/30 outline focus:ring-2 ring-accent ring-offset-1 px-[10px] py-[5px] outline-accent hover:outline-accent/60",type:"button",onClick:l},U(h.$t("New game")),1),y("button",{class:"rounded-[8px] outline focus:ring-2 ring-accent ring-offset-1 px-[10px] py-[5px] outline-accent hover:outline-accent/60",type:"button",onClick:p[2]||(p[2]=g=>m())},U(h.$t("Undo")),1)])])],64))}};export{on as _,kn as a};
